---
title: "Data Science HW-5"
author: "Kasturi Bhamidipati"
date: "2022-11-14"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggridges)
library(patchwork)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 9, 
  fig.height = 7,
  out.width = "95%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1


# Problem 2

## Importing the data

First we want to import the data. 

```{r import data}
homicide_raw = 
  read_csv(file = "./data/homicide-data.csv")
```

## Summary of the dataset 

`r skimr::skim(homicide_raw)`
- The `homicide` dataset has `r nrow(homicide_raw)` rows and `r ncol(homicide_raw)` columns. 
- It has the following variables: `r colnames(homicide_raw)`
- It provides details on the date of the homicide, the victims' name, age, sex, city and state. 
- It also had additional notes on the status of the case. 

## Creating `city_state` variable and summarizing

```{r city_state}
homicide_data = 
  homicide_raw%>%
  unite("city_state", city:state, remove = FALSE, sep=", ") %>%
  group_by(city_state) %>%
  count(disposition, name = "total_dispositions")%>%
  pivot_wider(
    names_from= "disposition",
    values_from= "total_dispositions"
    )%>%
  janitor::clean_names()%>% 
  replace(is.na(.), 0)%>%
  mutate(
    total_homicides = closed_by_arrest+closed_without_arrest+open_no_arrest, 
    unsolved_homicides = closed_without_arrest+open_no_arrest
  )
```

## `prop.test` for Baltimore 

```{r prop test baltimore}
baltimore= 
  prop.test(
  homicide_data %>%  
    filter(city_state == "Baltimore, MD") %>% 
    pull(unsolved_homicides),
  homicide_data %>%
    filter(city_state == "Baltimore, MD") %>% 
    pull(total_homicides)
  ) %>% 
  broom::tidy()%>%
  select(estimate, conf.low,conf.high)
```

## `prop.test` for each city

```{r prop test all cities}
homicide_data_pt = 
  homicide_data%>%
  mutate(
    proportions = map2(.x = unsolved_homicides, .y = total_homicides, ~prop.test(x = .x, n = .y)),
    tidied = map(.x = proportions, ~broom::tidy(.x))
    ) %>% 
  select(-proportions) %>% 
  unnest(tidied) %>% 
  select(city_state, estimate, conf.low,conf.high)
```

## Plot for estimates and CIs for each city 

```{r plot, dpi=500}
homicide_plot = 
  homicide_data_pt%>% 
  ggplot(aes(x = fct_reorder(city_state, estimate), y = estimate))+ 
  geom_point(alpha = 0.3)+
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))+
  labs(
    title = "Homicide Data Estimates and CIs for Each City", 
    x = "City", 
    y = "Estimate"
  )
ggsave(path = "results", "homicide_plot.pdf")

homicide_plot
```

