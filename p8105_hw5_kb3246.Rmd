---
title: "Data Science HW-5"
author: "Kasturi Bhamidipati"
date: "2022-11-14"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(tidyverse)
library(ggridges)
library(patchwork)
knitr::opts_chunk$set(
	echo = TRUE,
	warning = FALSE,
	fig.width = 9, 
  fig.height = 7,
  out.width = "95%"
)
theme_set(theme_minimal() + theme(legend.position = "bottom"))
options(
  ggplot2.continuous.colour = "viridis",
  ggplot2.continuous.fill = "viridis"
)
scale_colour_discrete = scale_colour_viridis_d
scale_fill_discrete = scale_fill_viridis_d
```

# Problem 1


# Problem 2

## Importing the data

First we want to import the data. 

```{r import data}
homicide_raw = 
  read_csv(file = "./data/homicide-data.csv")
```

## Summary of the dataset 

- The `homicide` dataset has `r nrow(homicide_raw)` rows and `r ncol(homicide_raw)` columns. 
- It has the following variables: `r colnames(homicide_raw)`

## Creating `city_state` variable and summarizing

```{r city_state}
homicide_data = 
  homicide_raw%>%
  janitor::clean_names()%>%
  mutate(
    city_state = str_c(city,state, sep = ","),
    status = 
      case_when(
        disposition == "Closed without arrest" ~ "unsolved", 
        disposition == "Open/No arrest" ~ "unsolved", 
        disposition == "Closed by arrest" ~ "solved"
      ))%>%
  group_by(city_state)%>%
  summarise(
    total= n(), 
    unsolved = sum(status=="unsolved")
  )
```

## `prop.test` for Baltimore and saving output as R object

```{r prop test baltimore}
prop.test(
  homicide_data %>% filter(city_state == "Baltimore,MD") %>% 
    pull(unsolved),
  homicide_data %>% filter(city_state == "Baltimore,MD") %>% 
    pull(total)) %>% 
  broom::tidy()%>% 
  saveRDS(., "./data/Baltimore_prop_test.rds")
```

## `prop.test` for each city

```{r prop test all cities}
homicide_data_pt = 
  homicide_data%>%
  mutate(
    prop_df =map2(.x = unsolved, .y = total, ~prop.test(x = .x, n = .y)),
    tidied =map(.x = prop_df, ~broom::tidy(.x))
    ) %>% 
  select(-prop_df) %>% 
  unnest(tidied) %>% 
  select(city_state, estimate, conf.low,conf.high)

homicide_data_pt
```

## Plot for estimates and CIs for each city 

```{r plot, dpi=500}
homicide_plot = 
  homicide_data_pt%>% 
  ggplot(aes(x = fct_reorder(city_state, estimate), y = estimate))+ 
  geom_point()+
  geom_errorbar(aes(ymin = conf.low, ymax = conf.high)) +
  theme(axis.text.x = element_text(angle = 90, vjust = 0.5, hjust = 1))

homicide_plot

ggsave(path = "results", "homicide_plot.pdf")

```

# Problem 3 



